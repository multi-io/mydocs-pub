<html>
<!-- -*- html -*- -->





<head>
  <title> ./Publish.pm </title>
</head>

<body>

  <h1> <a href=".">.</a>/Publish.pm </h1>

  <a href="Publish.pm">download original</a>

  <pre>
#!/usr/bin/perl -w

use strict;

BEGIN { @INC = ("perl/test", @INC); }

use Template;
use File::Copy;

sub htmlizable {
    local ($_) = shift;
    m!\.bsh$! or
    m!\.c$! or
    m!\.cc$! or
    m!\.cgi$! or
    m!\.classpath$! or
    m!consign$! or
    m!\.cs$! or
    m!\.css$! or
    m!\.dat$! or
    m!\.dtd$! or
    m!edit$! or
    m!\.el$! or
    m!\.eli$! or
    m!\.env$! or
    m!\.gplot$! or
    m!\.h$! or
    m!\.jad$! or
    m!\.java$! or
    m!\.jpr$! or
    m!\.js$! or
    m!\.latex$! or
    m!\.li$! or
    m!\.launch$! or
    m!\.local$! or
    m!\.log$! or
    m!\.ml$! or
    m!\.m$! or
    m!\.pac$! or
    m!\.php3$! or
    m!\.pl$! or
    m!\.pm$! or
    m!\.policy$! or
    m!\.project$! or
    m!\.py$! or
    m!\.rb$! or
    m!\.sax2$! or
    m!\.sc$! or
    m!\.show$! or
    m!\.sh$! or
    m!\.sql$! or
    m!\.templ$! or
    m!\.tex$! or
    m!\.txt$! or
    m!\.txt,v$! or
    m!\.url$! or
    m!\.xerces$! or
    m!Makefile$! or
    m!\.xml$! or
    m!wwwpublish$! or
    m!gh-publish$!;
}

sub publish($$);

sub publish($$) {
    # "our" variables are "our" so the template can acces it
    # we use "my" copies of those variables in this routine because
    #    using "our" (i.e. dynamically scoped) variables in recursive
    #    functions tends to be messy
    my ($_dir, $targetdir) = @_;
    print STDERR "publishing: $targetdir\n";
    unless (-d $targetdir) {
        mkdir $targetdir or die "couldn't mkdir $targetdir: $!";
    }
    open(IDXHTM, "&gt;$targetdir/index.html");
    my $_target_templ = "wwwpublish.d/index.templ";
    my $tpl = Template-&gt;new("wwwpublish.d/wrapper.templ", *IDXHTM);

    our $dir = $_dir;
    our $target_templ = $_target_templ;
    $tpl-&gt;run();

    close IDXHTM;

    foreach my $_f (@{$_dir-&gt;{FILES}}) {
        my $_fqsrcname = "$_dir-&gt;{PATH}$_f";

        copy($_fqsrcname, "${targetdir}/$_f");
        next unless (htmlizable($_fqsrcname));

        local $/=undef;
        open(F,"&lt;$_fqsrcname") or die "couldn't open $_fqsrcname: $!";
        my $_text = &lt;F&gt;;
        close F;
        $target_templ = "wwwpublish.d/file.templ";
        open(FILEHTM, "&gt;${targetdir}/$_f.html");
        my $tpl = Template-&gt;new("wwwpublish.d/wrapper.templ", *FILEHTM);

        our $f = $_f;
        our $fqsrcname = $_fqsrcname;
        our $text = $_text;
        $tpl-&gt;run();

        close FILEHTM;
    }

    foreach my $d (@{$dir-&gt;{DIRS}}) {
        publish($d, "$targetdir/$d-&gt;{NAME}");
    }
}


# for use by templates
sub htmlescape {
    $_=shift;
    my $repl = rand() . rand() . rand();
    my $replre = qr/$repl/;
    s!&amp;!$repl!sig;
    s!&lt;!&amp;lt;!sig;
    s!&gt;!&amp;gt;!sig;
    s!$replre!&amp;amp;!sig;
    $_;
}

1;

  </pre>

  <a href="."> back to . </a>

  <p/>

  <font size="-3">(C) 1998-2015 Olaf Klischat  &lt;olaf.klischat@gmail.com&gt; </font>

</body>

</html>
