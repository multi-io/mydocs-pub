(see also http://www-uxsup.csx.cam.ac.uk/courses/ipv6_basics/x84.html,
http://www.tcpipguide.com/free/t_IPv6NDOverviewHistoryMotivationandStandards.htm)

IPv6 transport over Ethernet (RFC 2464)
=======================================

- IPv6 packet packed into ethernet frame payload, the ethertype of the
  frame is set to 86dd (with IPv4 it was 0800)

- ...


IPv6 multicast, transport over Ethernet, Neighbor discovery
============================================================

- IPv6 multicast addresses are all addresses in ff00::/8

- ethernet multicast addresses are ones whose first byte's least
  significant bit is 1. E.g. 33-33-FF-68-12-CB is a multicast MAC
  address, while 00-C0-4F-68-12-CB is not.

  - the ethernet broadcast address FF-FF-FF-FF-FF-FF is just a special
    multicast address

  - TODO: which devices will listen for frames with a given multicast
    MAC address?

  - various groups of ethernet multicast addresses (multicast groups)
    are well-known; see
    http://www.cavebear.com/archive/cavebear/Ethernet/multicast.html. For
    example:

    Ethernet          Ethertype	
    Address	             Field  Usage

    01-00-0C-CC-CC-CC	-802-	CDP (Cisco Discovery Protocol), VTP (Virtual Trunking Protocol)

    01-00-5E-00-00-00	0800	DoD Internet Multicast (RFC-1112)
    through
    01-00-5E-7F-FF-FF

    01-80-C2-00-00-10	-802-	Bridge Management

    33-33-00-00-00-00	86DD	IPv6 Neighbor Discovery  (see below)
    through
    33-33-FF-FF-FF-FF

    An ethernet device is probably set up (by the driver, normally) to
    listen to multicast address groups (in addition to its own unique
    unicast MAC address).

    For example, an ethernet device that has one or more IPv6
    addresses assigned to it would probably listen to the IPv6
    Neighbor Discovery multicast group 33-33-xx-xx-xx-xx (or at least
    to some portions of it?)

- to send an IPv6 multicast packet over Ethernet, one simply takes the
  last 32 bits of the destination IPv6 address, prepends 33-33- and
  uses that as the destination Ethernet address. Any host which is
  interested in packets for that IPv6 address is expected to be
  listening for the corresponding Ethernet address.


Neighbor discovery (RFC 2461)
=============================

Set of functionalities related to router and host discovery and
configuration etc. Implemented on top of ICMPv6.

layer 2 address resolution
--------------------------

- IPv6 equivalent of ARP. Used for discovering the layer2 (MAC etc.)
  address for an IPv6 destination address.

- to find the MAC address for a given IPv6 address A, the discovering
  host sends an ICMPv6 packet containing the corresponding query to
  the "solicited-node multicast address" of A, which is
  FF02::1:FF<last 24 bits of A>. (this would in turn be sent to the
  ethernet multicast address 33-33-FF-<last 24 bits of A>, as per the
  IPv6-Ethernet multicast address conversion rule given above). (this
  scheme is chosen in order to ensure that hosts don't get disturbed
  by neighbour solicitations that aren't either for them or for a host
  with a very similar IPv6 address)

  The host with address A must listen to that multicast address. It
  receives the query and sends back its response, identifying its own
  layer2 address.


Address Autoconfiguration (RFC 2462)
------------------------------------

(TODO: elaborate, extend)

- after being turned on, a host assigns a "link-local" IPv6 address to
  each interface that IPv6 is enabled on, using only information
  that's available locally. This address is prefixed with fe80 (TODO:
  verify); the suffix is generated from the hardware (e.g. MAC)
  address of the interface. Before assigning this address, the host
  will check whether it is unique on the whole link-local (L2) network
  by sending out a "neighbor solicitation" to the address (with what
  source address?). If the address is NOT unique, autoconfiguration
  generally stops and manual configuration of the host is required.

- after the assignment of link-local addresses has succeded, hosts
  on the same layer 2 network will have IP connectivity.

TODO: elaborate:

* 2nd stage: stateless or stateful autoconfiguration using information
  sent out by routers in router advertisements / requested by router
  solicitations sent to the all-routers multicast group

* uniqueness check for such autoconfigured addresses as well, except
  if the layer 2 address portion was already tested during link-local
  address setup

* address deprecation

- TODO: continue


========

02:05 < multi_io> why does the Linux IPv6 HOWTO tell you to point the default route to 2000::/3?
02:05 < multi_io> shouldn't it just be ::/0 ?
02:06 < Simon-> no
02:06 < multi_io> (i.e. the target network)
02:06 < Simon-> 2000::/3 is allocated to global unicast
02:06 < Simon-> not ::/0
02:06 < Simon-> ff00::/8 is multicast
02:07 < Simon-> they're treated differently, but ::/0 is wrong.. although it's still used as the default 
                route after a router advert is received :/
02:08 < multi_io> so all global unicast host IPs ever assigned will be in 2000::/3 ?
02:08 < Simon-> no, there's another 6 /3s after that that will be assigned when that one runs out

(111 in the first 3 bits belongs to the mentioned ff00::/8 multicast
address space, so 2^3-2=6 /3 networks are still unassigned)
