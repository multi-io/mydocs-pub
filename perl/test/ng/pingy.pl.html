<html>
<!-- -*- html -*- -->





<head>
  <title> ./perl/test/ng/pingy.pl </title>
</head>

<body>

  <h1> <a href="../../../.">.</a>/<a href="../../.">perl</a>/<a href="../.">test</a>/<a href=".">ng</a>/pingy.pl </h1>

  <a href="pingy.pl">download original</a>

  <pre>
#!/usr/bin/perl

use Tk;

$queuesize=100;
$grain=10;

# localhost for a baseline
@hosts=('localhost', 'www.perl.com', 'www.yahoo.com');

$path="/tmp/fifo_ping";
if  ( system('mknod',  $path, 'p')
        &amp;&amp; system('mkfifo', $path) )
   {
       die("mk{nod,fifo} $path failed") if (! $! =~ /exists/);
   }


foreach (@hosts) {
        if ($pid=fork) {
                push(@children, $pid);
                $host="";
        } else {
                @children=();
                $host=$_;
                last;
        }
}

if (! @children) {
        undef %hosts;
        undef $win;
        use Net::Ping;
        $p=new Net::Ping('icmp', 1, 128);

        open(FIFO, "&gt;&gt;$path") || die;
        select(FIFO); $|=1;
        while(1) {
                if ($p-&gt;ping($host, 1)) {
                        print FIFO "$host 1\n";
                        sleep 1;
                } else {
                        print FIFO "$host 0\n";
                }
        }
        close(FIFO);
} else {
        $win=new Tk::MainWindow();
        foreach(@hosts) {
                my $f=$win-&gt;Frame()-&gt;pack(-side =&gt; 'left');
                $f-&gt;Label(-text =&gt; $_)-&gt;pack();
                $hosts{$_}=$f-&gt;Scale(qw/-orient vertical -length 300 -from/, 
                        $queuesize, qw/-to 0 -tickinterval/, $grain);
                $hosts{$_}-&gt;pack();
        }
        open(FIFO, "$path") || die;
        while(&lt;FIFO&gt;) {
                ($host, $ok)=split(/\s+/, $_);
                push(@{$results{$host}}, $ok);
                if (@{$results{$host}} &gt; $queuesize) {
                        shift(@{$results{$host}});
                }
                disp_results(%results);
        }
        close(FIFO);
}

sub disp_results {
        my(%res)=@_;

        foreach(sort keys %res) {
                my $i=0;
                for(@{$res{$_}}) { $i++ if $_ };
                $hosts{$_}-&gt;set( $i );
        }
        $win-&gt;update;
}


  </pre>

  <a href="."> back to ng </a>

  <p/>

  <font size="-3">(C) 1998-2016 Olaf Klischat  &lt;olaf.klischat@gmail.com&gt; </font>

</body>

</html>
